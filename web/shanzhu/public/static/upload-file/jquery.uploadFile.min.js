(function(c){var k=function(b){for(var a=[],c=0;c<b.length;++c)a.push("*."+b[c]);return"\u53ea\u652f\u6301\u4e0a\u4f20&nbsp;&nbsp;"+a.join("&nbsp;&nbsp;&nbsp;")+"&nbsp;&nbsp;\u683c\u5f0f\u7684\u6587\u4ef6\u3002"},m=function(b){var a={ext:"",fileName:b};0<b.indexOf(".")&&(b=b.split("."),a.ext=b.pop(),a.fileName=b.join("."));return a},n=function(b){return b=1073741824<=b?Math.round(b/1073741824*100)/100+"GB":1048576<=b?Math.round(b/1048576*100)/100+"MB":1024<=b?Math.round(b/1024*100)/100+"KB":b+"B"},
    p=function(b){for(var a="apk chm js mdb pdf php psd txt exe xml fla swf flv png bmp ai".split(" "),c={doc:"doc docx dot dotx docm .dotm".split(" "),obj:["obj","lib"],audio:"mp3 cd ogg wma wav midi vqf".split(" "),dll:["dll","ocx","so"],html:["html","htm","shtm","link"],image:["jpg","jpeg","gif"],ppt:"ppt pptx pps pptm ppsx ppam potm".split(" "),css:["css","ini","inf"],video:"mp4 rm rmvb ram mov avi mkv wmv mpeg mpg aiff qt asf vob vod 3gp".split(" "),xls:"xls xlsx xlsm xltx xltm xlsb xlam".split(" "),
        zip:"rar zip cab arj lzh ace tar gz iso 7z bz gz uha uda zpaq".split(" ")},e="icon-file-",g=!1,f=0;f<a.length;++f)if(a[f]==b){e+=a[f];g=!0;break}if(!g){a=!1;for(var h in c){for(g=0;g<c[h].length;++g)if(c[h][g]==b){a=!0;e+=h;break}if(a)break}a||(e+="unknow")}return e},l=function(b,a,d,e){var g=b.find(".icon-file-loading").parent(),f=m(d),h='<i class="icon-file '+p(f.ext)+'"></i><a href="'+a.url+'" title="'+d+'" target="_blank" class="file">'+d+"</a>";e.isShowSize&&(h+='<span class="size-tip">('+n(a.size)+
        ")</span>");e.isEdit&&(h+='<a href="javascript:;" class="iconfont icon-edit" title="\u4fee\u6539\u6587\u4ef6\u540d"></a>');h+='<a href="javascript:;" class="iconfont icon-delete" title="\u79fb\u9664"></a><input type="hidden" name="'+e.controlName+'[\'url\'][]" class="url" value="'+a.url+'" /><input type="hidden" name="'+e.controlName+'[\'fullName\'][]" class="full-name" value="'+d+'" /><input type="hidden" name="'+e.controlName+'[\'fileName\'][]" class="file-name" value="'+f.fileName+'" /><input type="hidden" name="'+
        e.controlName+'[\'ext\'][]" class="ext" value="'+f.ext+'" /><input type="hidden" name="'+e.controlName+'[\'size\'][]" class="size" value="'+a.size+'" />';g.html(h);b.find(".icon-delete").off("click").on("click",function(){var a=c(this).parent(),e=a.find(".full-name").val();c.sui.confirm("\u662f\u5426\u786e\u5b9a\u79fb\u9664\u6587\u4ef6 "+e+" \u5417\uff1f",function(){a.remove();b.find(".uploadFile-btn-bar button").prop("disabled",!1)})});b.find(".icon-edit").off("click").on("click",function(){var a=
        c(this).parent(),b=a.find(".file-name").val(),e=a.find(".ext").val();c("body").append('<div id="uploadFileDialog" style="display:none"><table><tr><th>\u6587\u4ef6\u540d</th><td><input type="text" value="'+b+'" id="inputFileName" /> &nbsp;.'+e+"</td></tr></table></div>");c("#inputFileName").select();c("#uploadFileDialog").dialog({modal:!0,resizable:!1,dialogClass:"jquery-ui-dialog-iframe jquery-dialog-form",closeText:"",title:"\u4fee\u6539\u6587\u4ef6\u540d",width:400,close:function(){c(this).remove()},
        buttons:[{text:"\u786e\u5b9a",click:function(){var b=c.trim(c("#inputFileName").val());if(0>=b.length)return c.sui.alert("\u6587\u4ef6\u540d\u4e0d\u80fd\u4e3a\u7a7a\u3002",function(){c("#inputFileName").focus()}),!1;var e=a.find(".ext").val();a.find(".full-name").val(b+"."+e);a.find(".file").text(b+"."+e);a.find(".file-name").val(b);c(this).dialog("close").remove()}},{text:"\u53d6\u6d88",click:function(){c(this).dialog("close").remove()}}]})})},q=function(b,a){var d=a.tips;if(!d)if(0>=a.accept.length)d=
        "\u8bf7\u9009\u62e9\u8981\u4e0a\u4f20\u7684\u6587\u4ef6\uff0c\u652f\u6301\u4e0a\u4f20\u4efb\u610f\u683c\u5f0f\u3002";else{var e=[];for(d=0;d<a.accept.length;++d)e.push("*."+a.accept[d]);d=k(a.accept)}var g=b.attr("id")+"_uploadButton";b.html('<div class="uploadFile-btn-bar"><button class="btn btn-info" id="'+g+'" type="button"><i class="iconfont icon-upload"></i> '+a.buttonText+'</button></div><div class="uploadFile-tips">'+d+'</div><div class="uploadFile-list"><ul></ul></div>');a.isSort&&b.find("ul").sortable();
        if(a.data){if(0<a.length&&a.data.length>a.length)return c.sui.error("uploadFile\u63d2\u4ef6\uff1a\u521d\u59cb\u5316\u6570\u636e\u6ea2\u51fa\uff01"),c("#"+g).prop("disabled",!0),!1;for(d=0;d<a.data.length;++d)e=a.data[d].fullName,b.find("ul").append('<li><div class="icon-file-loading"></div></li>'),l(b,a.data[d],e,a)}new AjaxUpload(g,{action:a.url,name:a.fileControlName,onSubmit:function(e,d){d=d.toLowerCase();var f=!0;if(0<a.accept.length){f=!1;for(var h=0;h<a.accept.length;++h)if(a.accept[h]==d){f=
                !0;break}if(!f&&!c.isFunction(a.onSubmit))return c.sui.alert(k(a.accept)),!1}if(c.isFunction(a.onSubmit)&&!1===a.onSubmit(e,d,f))return!1;if(0<a.length&&b.find(".uploadFile-list li").length>=a.length)return c.sui.alert("\u6700\u591a\u53ea\u652f\u6301\u4e0a\u4f20"+a.length+"\u4e2a\u6587\u4ef6\u3002"),!1;b.find(".uploadFile-list ul").append('<li><div class="icon-file-loading">'+e+" \u4e0a\u4f20\u4e2d...</div></li>");c("#"+g).prop("disabled",!0)},onComplete:function(e,d){if(c.isFunction(a.onComplete))a.onComplete(e,
                d);try{var f=JSON.parse(d);if(0==f.code){var h=f.data;c("#"+g).prop("disabled",!1);0<a.length&&b.find(".uploadFile-list li").length>=a.length&&c("#"+g).prop("disabled",!0);l(b,h,e,a)}else c.sui.error(f.message||"\u7f51\u7edc\u8fde\u63a5\u8d85\u65f6\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc")}catch(r){c.sui.error("\u7f51\u7edc\u8fde\u63a5\u8d85\u65f6\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u3002")}}});0<a.length&&a.data&&a.data.length==a.length&&c("#"+g).prop("disabled",!0)};c.fn.uploadFile=function(b){var a=
    c(this);if("string"==typeof b&&"get"==b){var d=[];a.find(".url").each(function(a,b){a=c(b);d.push({url:a.val(),fullName:a.siblings(".full-name").val(),fileName:a.siblings(".file-name").val(),ext:a.siblings(".ext").val(),size:a.siblings(".size").val()})});return d}b=c.extend({length:0,url:"",buttonText:"\u4e0a\u4f20\u9644\u4ef6",tips:"",controlName:"attachment",fileControlName:"file",accept:[],isEdit:!0,isShowSize:!0,isSort:!0,data:null,onSubmit:null,onComplete:null},b);1<c(this).length?alert("\u521d\u59cb\u5316\u5931\u8d25\uff0c\u63d2\u4ef6\u53ea\u652f\u6301\u4e00\u4e2a\u5b9e\u4f8b\u3002"):
    q(a,b)}})(jQuery);